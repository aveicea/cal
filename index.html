<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>공유용 구글 캘린더 뷰어</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #calendar { max-width: 1200px; margin: 50px auto; }
  </style>
</head>
<body>
  <div id="calendar"></div>

  <script>
    // ICS URL과 캘린더 색상을 정의
    const calendars = [
      { url: "YOUR_CALENDAR_ID_1.ics", color: '#1a73e8', textColor: 'white' },
      { url: "YOUR_CALENDAR_ID_2.ics", color: '#34a853', textColor: 'white' },
      { url: "YOUR_CALENDAR_ID_3.ics", color: '#fbbc05', textColor: 'white' }
    ];

    function parseICS(data) {
      const events = [];
      const lines = data.split(/\r?\n/);
      let event = {};
      for (let line of lines) {
        if (line.startsWith('BEGIN:VEVENT')) event = {};
        else if (line.startsWith('END:VEVENT')) events.push(event);
        else if (line.startsWith('SUMMARY:')) event.title = line.replace('SUMMARY:', '');
        else if (line.startsWith('DTSTART')) event.start = line.replace(/DTSTART.*:/, '');
        else if (line.startsWith('DTEND')) event.end = line.replace(/DTEND.*:/, '');
      }
      return events.map(ev => {
        // 날짜 형식 변환 (YYYYMMDD 또는 YYYYMMDDTHHMMSS)
        ev.start = ev.start.replace(/T/, ''); 
        ev.end = ev.end.replace(/T/, '');
        return ev;
      });
    }

    async function loadAllCalendars() {
      const allEvents = [];
      for (let cal of calendars) {
        try {
          const res = await fetch(cal.url);
          if (!res.ok) throw new Error("ICS 로드 실패");
          const text = await res.text();
          const events = parseICS(text);
          events.forEach(ev => {
            ev.color = cal.color;
            ev.textColor = cal.textColor;
          });
          allEvents.push(...events);
        } catch (err) {
          console.warn(`⚠️ ${cal.url} 로드 실패: 공개 여부/CORS 확인 필요`);
        }
      }
      return allEvents;
    }

    document.addEventListener('DOMContentLoaded', async function() {
      const calendarEl = document.getElementById('calendar');
      const events = await loadAllCalendars();

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: events
      });

      calendar.render();
    });
  </script>
</body>
</html>
