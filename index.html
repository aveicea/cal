<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìº˜ë¦°ë” ë·°ì–´</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #ffffff;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  .header {
    padding: 10px 20px;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
  }
  
  .view-selector {
    display: flex;
    gap: 8px;
    align-items: center;
    flex: 1;
    justify-content: center;
  }
  
  .view-btn {
    padding: 6px 12px;
    border: 1px solid #ddd;
    background: white;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: #666;
  }
  
  .view-btn.active {
    background: var(--accent-color, #4285f4);
    color: white;
    border-color: var(--accent-color, #4285f4);
  }
  
  .nav-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-right: 20px;
  }
  
  .nav-btn {
    width: 32px;
    height: 32px;
    border: 1px solid #ddd;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .nav-btn:hover {
    background: #f8f9fa;
  }
  
  .current-date {
    padding: 6px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    min-width: 120px;
    text-align: center;
  }
  
  .settings-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    transition: all 0.2s ease;
  }
  
  .settings-btn:hover {
    background: #e8eaed;
    color: #333;
  }
  
  .settings-panel {
    position: absolute;
    top: 45px;
    right: 20px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    width: 350px;
    z-index: 1000;
    display: none;
    max-height: 500px;
    overflow-y: auto;
  }
  
  .settings-title {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 15px;
    color: #333;
  }
  
  .color-picker-group {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .color-picker-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 10px;
    color: #333;
  }
  
  .color-input-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .color-picker-input {
    width: 40px;
    height: 30px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    padding: 0;
  }
  
  .color-text-input {
    flex: 1;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 12px;
    font-family: monospace;
  }
  
  .preset-colors {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 4px;
  }
  
  .preset-color {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .preset-color:hover {
    transform: scale(1.1);
    border-color: #333;
  }
  
  .api-key-section {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .input-group {
    margin-bottom: 10px;
  }
  
  .input-group label {
    display: block;
    font-size: 12px;
    color: #666;
    margin-bottom: 4px;
  }
  
  .input-group input {
    width: 100%;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 12px;
    box-sizing: border-box;
  }
  
  .btn {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .btn-primary {
    background: var(--accent-color, #4285f4);
    color: white;
  }
  
  .btn-primary:hover {
    background: var(--accent-hover-color, #3367d6);
  }
  
  .btn-secondary {
    background: #f8f9fa;
    color: #666;
    border: 1px solid #ddd;
  }
  
  .calendar-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  .calendar-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f8f9fa;
  }
  
  .calendar-grid {
    display: grid;
    gap: 1px;
    background: #e0e0e0;
    border: 1px solid #e0e0e0;
  }
  
  .calendar-day {
    background: white;
    min-height: 100px;
    padding: 8px;
    position: relative;
  }
  
  .calendar-day.other-month {
    background: #f8f9fa;
    color: #999;
  }
  
  .calendar-day.today {
    background: #e3f2fd;
  }
  
  .day-number {
    font-weight: 500;
    margin-bottom: 4px;
  }
  
  .event {
    background: var(--accent-color, #4285f4);
    color: white;
    padding: 2px 4px;
    border-radius: 2px;
    font-size: 11px;
    margin-bottom: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .week-view {
    display: grid;
    grid-template-columns: 60px repeat(7, 1fr);
    gap: 1px;
    background: #e0e0e0;
  }
  
  .time-slot {
    background: white;
    padding: 4px;
    font-size: 12px;
    color: #666;
    border-right: 1px solid #e0e0e0;
  }
  
  .week-day {
    background: white;
    min-height: 60px;
    position: relative;
  }
  
  .week-header {
    background: #f5f5f5;
    padding: 8px;
    font-weight: 500;
    text-align: center;
    font-size: 14px;
  }
  
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 200px;
    color: #666;
  }
  
  .error-message {
    background: #ffebee;
    border: 1px solid #ffcdd2;
    border-radius: 8px;
    padding: 16px;
    margin: 20px;
    color: #c62828;
  }
  
  .setup-message {
    background: white;
    border-radius: 12px;
    padding: 40px;
    margin: 40px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }
  
  .setup-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }
  
  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.1);
    z-index: 999;
    display: none;
  }
  
  @media (max-width: 768px) {
    .settings-panel {
      right: 10px;
      left: 10px;
      width: auto;
    }
    .nav-controls {
      margin-right: 10px;
    }
    .calendar-grid {
      grid-template-columns: repeat(7, 1fr);
    }
    .calendar-day {
      min-height: 80px;
    }
  }
  
  /* ì›”ê°„ ë·° */
  .month-view {
    grid-template-columns: repeat(7, 1fr);
  }
  
  /* ì£¼ê°„ ë·° í—¤ë” */
  .week-view .week-header {
    grid-column: span 1;
  }
  
  .week-view .time-header {
    background: #f5f5f5;
    grid-column: 1;
  }
</style>
</head>
<body>
  <div class="header">
    <div class="view-selector">
      <button class="view-btn" onclick="setView('day')" id="dayBtn">ì¼ê°„</button>
      <button class="view-btn" onclick="setView('week')" id="weekBtn">ì£¼ê°„</button>
      <button class="view-btn active" onclick="setView('month')" id="monthBtn">ì›”ê°„</button>
    </div>
    
    <div class="nav-controls">
      <button class="nav-btn" onclick="navigateCalendar(-1)">â€¹</button>
      <div class="current-date" id="currentDate"></div>
      <button class="nav-btn" onclick="navigateCalendar(1)">â€º</button>
      <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
    </div>
    
    <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
    
    <div class="settings-panel" id="settingsPanel">
      <div class="settings-title">ì„¤ì •</div>
      
      <div class="color-picker-group">
        <div class="color-picker-title">í…Œë§ˆ ìƒ‰ìƒ</div>
        <div class="color-input-row">
          <input type="color" class="color-picker-input" id="colorPicker" onchange="updateColorFromPicker()">
          <input type="text" class="color-text-input" id="colorText" placeholder="#4285F4" oninput="updateColorFromText()" maxlength="7">
        </div>
        <div class="preset-colors">
          <div class="preset-color" style="background-color: #4285f4;" onclick="setPresetColor('#4285f4')"></div>
          <div class="preset-color" style="background-color: #34a853;" onclick="setPresetColor('#34a853')"></div>
          <div class="preset-color" style="background-color: #ea4335;" onclick="setPresetColor('#ea4335')"></div>
          <div class="preset-color" style="background-color: #fbbc04;" onclick="setPresetColor('#fbbc04')"></div>
          <div class="preset-color" style="background-color: #9c27b0;" onclick="setPresetColor('#9c27b0')"></div>
          <div class="preset-color" style="background-color: #ff6d00;" onclick="setPresetColor('#ff6d00')"></div>
          <div class="preset-color" style="background-color: #607d8b;" onclick="setPresetColor('#607d8b')"></div>
          <div class="preset-color" style="background-color: #795548;" onclick="setPresetColor('#795548')"></div>
          <div class="preset-color" style="background-color: #e91e63;" onclick="setPresetColor('#e91e63')"></div>
          <div class="preset-color" style="background-color: #00bcd4;" onclick="setPresetColor('#00bcd4')"></div>
          <div class="preset-color" style="background-color: #8bc34a;" onclick="setPresetColor('#8bc34a')"></div>
          <div class="preset-color" style="background-color: #ffc107;" onclick="setPresetColor('#ffc107')"></div>
        </div>
      </div>
      
      <div class="api-key-section">
        <div class="color-picker-title">êµ¬ê¸€ ìº˜ë¦°ë” ì„ë² ë“œ</div>
        <div class="input-group">
          <label>iCal ìº˜ë¦°ë” ë§í¬</label>
          <input type="text" id="calendarUrl" placeholder="êµ¬ê¸€ ìº˜ë¦°ë” iCal ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: .ics íŒŒì¼ ë§í¬)">
        </div>
        <button class="btn btn-primary" onclick="addSubscribedCalendar()">ìº˜ë¦°ë” êµ¬ë… ì¶”ê°€</button>
        <button class="btn btn-secondary" onclick="showSampleData()">ìƒ˜í”Œ ë°ì´í„° ë³´ê¸°</button>
      </div>
      
      <div class="subscribed-calendars-section">
        <div class="color-picker-title">êµ¬ë…ëœ ìº˜ë¦°ë”</div>
        <div id="subscribedCalendarsList">
          <!-- êµ¬ë…ëœ ìº˜ë¦°ë”ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>
  </div>
  
  <div class="overlay" id="overlay" onclick="closeSettings()"></div>
  
  <div class="calendar-container">
    <div class="calendar-content" id="calendarContent">
      <div class="setup-message">
        <div class="setup-icon">ğŸ“…</div>
        <h2>ìì²´ ì œì‘ ìº˜ë¦°ë” ë·°ì–´</h2>
        <p>Google Calendar APIë¥¼ ì‚¬ìš©í•˜ì—¬ ìº˜ë¦°ë” ë°ì´í„°ë¥¼ ì§ì ‘ ê°€ì ¸ì™€ì„œ í‘œì‹œí•©ë‹ˆë‹¤.</p>
        <p style="font-size: 14px; color: #666; margin-top: 16px;">
          ìš°ìƒë‹¨ ì„¤ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìº˜ë¦°ë”ë¥¼ ì—°ë™í•˜ê±°ë‚˜ ìƒ˜í”Œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
        </p>
      </div>
    </div>
  </div>

<script>
  // ì „ì—­ ë³€ìˆ˜
  let currentView = 'month';
  let currentDate = new Date();
  let accentColor = '#4285f4';
  let accentHoverColor = '#3367d6';
  let calendarEvents = [];
  
  // êµ¬ë…ëœ ìº˜ë¦°ë” ëª©ë¡
  let subscribedCalendars = [];
  
  // DOM ìš”ì†Œ
  const settingsPanel = document.getElementById("settingsPanel");
  const overlay = document.getElementById("overlay");
  const colorPicker = document.getElementById("colorPicker");
  const colorText = document.getElementById("colorText");
  const currentDateElement = document.getElementById("currentDate");
  const calendarContent = document.getElementById("calendarContent");
  
  // ì´ˆê¸°í™”
  async function init() {
    loadFromStorage();
    await loadSubscribedCalendars();
    updateCurrentDateDisplay();
    setAccentColor(accentColor);
  }
  
  // ì„¤ì • íŒ¨ë„
  function toggleSettings() {
    const isVisible = settingsPanel.style.display === 'block';
    if (isVisible) {
      closeSettings();
    } else {
      openSettings();
    }
  }
  
  function openSettings() {
    settingsPanel.style.display = 'block';
    overlay.style.display = 'block';
  }
  
  function closeSettings() {
    settingsPanel.style.display = 'none';
    overlay.style.display = 'none';
  }
  
  // ë·° ë³€ê²½
  function setView(viewMode) {
    currentView = viewMode;
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(viewMode + 'Btn').classList.add('active');
    updateCurrentDateDisplay();
    renderCalendar();
    saveToStorage();
  }
  
  // ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜
  function navigateCalendar(direction) {
    if (currentView === 'month') {
      currentDate.setMonth(currentDate.getMonth() + direction);
    } else if (currentView === 'week') {
      currentDate.setDate(currentDate.getDate() + (direction * 7));
    } else if (currentView === 'day') {
      currentDate.setDate(currentDate.getDate() + direction);
    }
    updateCurrentDateDisplay();
    renderCalendar();
  }
  
  function goToToday() {
    currentDate = new Date();
    updateCurrentDateDisplay();
    renderCalendar();
  }
  
  function updateCurrentDateDisplay() {
    const options = { year: 'numeric', month: 'long', locale: 'ko-KR' };
    if (currentView === 'day') {
      options.day = 'numeric';
      options.weekday = 'long';
    }
    currentDateElement.textContent = currentDate.toLocaleDateString('ko-KR', options);
  }
  
  // ìƒ‰ìƒ ê´€ë¦¬
  function darkenColor(hex, percent) {
    const num = parseInt(hex.replace("#", ""), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) - amt;
    const G = (num >> 8 & 0x00FF) - amt;
    const B = (num & 0x0000FF) - amt;
    return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
      (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
      (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
  }
  
  function setAccentColor(color) {
    accentColor = color;
    accentHoverColor = darkenColor(color, 15);
    
    document.documentElement.style.setProperty('--accent-color', color);
    document.documentElement.style.setProperty('--accent-hover-color', accentHoverColor);
    
    colorPicker.value = color;
    colorText.value = color.toUpperCase();
    
    saveToStorage();
  }
  
  function setPresetColor(color) {
    setAccentColor(color);
  }
  
  function updateColorFromPicker() {
    setAccentColor(colorPicker.value);
  }
  
  function updateColorFromText() {
    let color = colorText.value.trim();
    if (!color.startsWith('#')) color = '#' + color;
    if (/^#[0-9A-F]{6}$/i.test(color)) {
      setAccentColor(color);
    }
  }
  
  // ìº˜ë¦°ë” ë Œë”ë§
  function renderCalendar() {
    if (currentView === 'month') {
      renderMonthView();
    } else if (currentView === 'week') {
      renderWeekView();
    } else if (currentView === 'day') {
      renderDayView();
    }
  }
  
  function renderMonthView() {
    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const grid = document.createElement('div');
    grid.className = 'calendar-grid month-view';
    
    // ìš”ì¼ í—¤ë”
    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    weekdays.forEach(day => {
      const header = document.createElement('div');
      header.className = 'week-header';
      header.textContent = day;
      grid.appendChild(header);
    });
    
    // ë‚ ì§œ ì…€
    const today = new Date();
    for (let i = 0; i < 42; i++) {
      const cellDate = new Date(startDate);
      cellDate.setDate(startDate.getDate() + i);
      
      const cell = document.createElement('div');
      cell.className = 'calendar-day';
      
      if (cellDate.getMonth() !== currentDate.getMonth()) {
        cell.classList.add('other-month');
      }
      
      if (cellDate.toDateString() === today.toDateString()) {
        cell.classList.add('today');
      }
      
      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = cellDate.getDate();
      cell.appendChild(dayNumber);
      
      // ì´ë²¤íŠ¸ í‘œì‹œ
      const dayEvents = getEventsForDate(cellDate);
      dayEvents.forEach(event => {
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event';
        eventDiv.textContent = event.title;
        eventDiv.title = event.title + '\n' + event.time;
        
        // êµ¬ë… ìº˜ë¦°ë” ì´ë²¤íŠ¸ëŠ” ë‹¤ë¥¸ ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œ
        if (event.calendarId && event.color) {
          eventDiv.style.backgroundColor = event.color;
        }
        
        cell.appendChild(eventDiv);
      });
      
      grid.appendChild(cell);
    }
    
    calendarContent.innerHTML = '';
    calendarContent.appendChild(grid);
  }
  
  function renderWeekView() {
    const startOfWeek = new Date(currentDate);
    startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
    
    const grid = document.createElement('div');
    grid.className = 'calendar-grid week-view';
    
    // ì‹œê°„ í—¤ë”
    const timeHeader = document.createElement('div');
    timeHeader.className = 'week-header time-header';
    timeHeader.textContent = 'ì‹œê°„';
    grid.appendChild(timeHeader);
    
    // ìš”ì¼ í—¤ë”
    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    for (let i = 0; i < 7; i++) {
      const date = new Date(startOfWeek);
      date.setDate(startOfWeek.getDate() + i);
      
      const header = document.createElement('div');
      header.className = 'week-header';
      header.innerHTML = `${weekdays[i]}<br><small>${date.getDate()}</small>`;
      grid.appendChild(header);
    }
    
    // ì‹œê°„ ìŠ¬ë¡¯ (9ì‹œ-18ì‹œ)
    for (let hour = 9; hour <= 18; hour++) {
      const timeSlot = document.createElement('div');
      timeSlot.className = 'time-slot';
      timeSlot.textContent = `${hour}:00`;
      grid.appendChild(timeSlot);
      
      for (let day = 0; day < 7; day++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + day);
        
        const cell = document.createElement('div');
        cell.className = 'week-day';
        
        const dayEvents = getEventsForDate(date).filter(event => {
          const eventHour = parseInt(event.time.split(':')[0]);
          return eventHour === hour;
        });
        
        dayEvents.forEach(event => {
          const eventDiv = document.createElement('div');
          eventDiv.className = 'event';
          eventDiv.textContent = event.title;
          eventDiv.title = event.title + '\n' + event.time;
          cell.appendChild(eventDiv);
        });
        
        grid.appendChild(cell);
      }
    }
    
    calendarContent.innerHTML = '';
    calendarContent.appendChild(grid);
  }
  
  function renderDayView() {
    const grid = document.createElement('div');
    grid.className = 'calendar-grid week-view';
    grid.style.gridTemplateColumns = '60px 1fr';
    
    // í—¤ë”
    const timeHeader = document.createElement('div');
    timeHeader.className = 'week-header';
    timeHeader.textContent = 'ì‹œê°„';
    grid.appendChild(timeHeader);
    
    const dayHeader = document.createElement('div');
    dayHeader.className = 'week-header';
    dayHeader.textContent = currentDate.toLocaleDateString('ko-KR', { 
      weekday: 'long', 
      month: 'long', 
      day: 'numeric' 
    });
    grid.appendChild(dayHeader);
    
    // ì‹œê°„ ìŠ¬ë¡¯
    for (let hour = 6; hour <= 23; hour++) {
      const timeSlot = document.createElement('div');
      timeSlot.className = 'time-slot';
      timeSlot.textContent = `${hour}:00`;
      grid.appendChild(timeSlot);
      
      const cell = document.createElement('div');
      cell.className = 'week-day';
      cell.style.minHeight = '60px';
      
      const dayEvents = getEventsForDate(currentDate).filter(event => {
        const eventHour = parseInt(event.time.split(':')[0]);
        return eventHour === hour;
      });
      
      dayEvents.forEach(event => {
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event';
        eventDiv.textContent = event.title;
        eventDiv.title = event.title + '\n' + event.time;
        cell.appendChild(eventDiv);
      });
      
      grid.appendChild(cell);
    }
    
    calendarContent.innerHTML = '';
    calendarContent.appendChild(grid);
  }
  
  // ì´ë²¤íŠ¸ ë°ì´í„° ê´€ë¦¬
  function getEventsForDate(date) {
    return calendarEvents.filter(event => {
      const eventDate = new Date(event.date);
      return eventDate.toDateString() === date.toDateString();
    });
  }
  
  function showSampleData() {
    calendarEvents = generateSampleEvents();
    renderCalendar();
    closeSettings();
  }
  
  function generateSampleEvents() {
    const events = [];
    const today = new Date();
    
    // ì´ë²ˆ ë‹¬ì˜ ìƒ˜í”Œ ì´ë²¤íŠ¸ë“¤
    for (let i = 0; i < 20; i++) {
      const eventDate = new Date(today.getFullYear(), today.getMonth(), Math.floor(Math.random() * 28) + 1);
      const hour = Math.floor(Math.random() * 10) + 9; // 9ì‹œ-18ì‹œ
      const minute = Math.random() > 0.5 ? '00' : '30';
      
      const sampleTitles = [
        'íšŒì˜', 'í”„ë ˆì  í…Œì´ì…˜', 'í”„ë¡œì íŠ¸ ë¦¬ë·°', 'íŒ€ ë¯¸íŒ…', 'í´ë¼ì´ì–¸íŠ¸ ë¯¸íŒ…',
        'ì›Œí¬ìˆ', 'êµìœ¡', 'ì ì‹¬ì•½ì†', 'ë³‘ì›', 'ê°œì¸ ì‹œê°„',
        'ìš´ë™', 'ë…ì„œ', 'ì‡¼í•‘', 'ì˜í™”', 'ë°ì´íŠ¸'
      ];
      
      events.push({
        title: sampleTitles[Math.floor(Math.random() * sampleTitles.length)],
        date: eventDate.toISOString().split('T')[0],
        time: `${hour}:${minute}`
      });
    }
    
    return events;
  }
  
  async function loadCalendarData() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const calendarId = document.getElementById('calendarId').value.trim() || 'primary';
    
    if (!apiKey) {
      alert('Google Calendar APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\nìƒ˜í”Œ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!');
      return;
    }
    
    try {
      calendarContent.innerHTML = '<div class="loading">ìº˜ë¦°ë” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
      
      // Google Calendar API í˜¸ì¶œ
      const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).toISOString();
      const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).toISOString();
      
      const response = await fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`);
      
      if (!response.ok) {
        throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
      }
      
      const data = await response.json();
      
      calendarEvents = data.items.map(event => {
        const startDate = event.start.dateTime || event.start.date;
        const date = new Date(startDate);
        
        return {
          title: event.summary || 'ì œëª© ì—†ìŒ',
          date: date.toISOString().split('T')[0],
          time: event.start.dateTime ? 
            date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼'
        };
      });
      
      renderCalendar();
      closeSettings();
      
    } catch (error) {
      console.error('ìº˜ë¦°ë” ë¡œë“œ ì˜¤ë¥˜:', error);
      calendarContent.innerHTML = `
        <div class="error-message">
          <strong>ìº˜ë¦°ë” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong><br>
          ${error.message}<br><br>
          <small>
          â€¢ API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”<br>
          â€¢ ìº˜ë¦°ë” IDê°€ ì •í™•í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”<br>
          â€¢ API í‚¤ì— Calendar API ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”
          </small>
        </div>
      `;
    }
  }
  
  // êµ¬ê¸€ ìº˜ë¦°ë” ì„ë² ë“œ ë¡œë“œ í•¨ìˆ˜
  function loadEmbeddedCalendar() {
    const url = document.getElementById('calendarUrl').value.trim();
    
    if (!url) {
      alert('ìº˜ë¦°ë” URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
  
    if (!url.includes('calendar.google.com')) {
      alert('ì˜¬ë°”ë¥¸ êµ¬ê¸€ ìº˜ë¦°ë” URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    try {
      // URL ìœ íš¨ì„± ê²€ì‚¬
      new URL(url);
      
      // ìº˜ë¦°ë” í”„ë ˆì„ ìƒì„±
      const iframe = document.createElement('iframe');
      iframe.style.width = '100%';
      iframe.style.height = '600px';
      iframe.style.border = 'none';
      iframe.style.borderRadius = '8px';
      iframe.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
      iframe.src = url;
      iframe.title = 'êµ¬ê¸€ ìº˜ë¦°ë”';
      
      // ì»¨í…Œì´ë„ˆ ë‚´ìš© êµì²´
      calendarContent.innerHTML = '';
      calendarContent.appendChild(iframe);
      
      // ì„¤ì • íŒ¨ë„ ë‹«ê¸°
      closeSettings();
      
    } catch (error) {
      alert('ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
    }
  }
  
  // êµ¬ë… ìº˜ë¦°ë” ì¶”ê°€
  function addSubscribedCalendar() {
    const url = document.getElementById('calendarUrl').value.trim();
    
    if (!url) {
      alert('iCal ìº˜ë¦°ë” ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
  
    if (!url.includes('.ics') && !url.includes('ical')) {
      alert('ì˜¬ë°”ë¥¸ iCal ìº˜ë¦°ë” ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (.ics íŒŒì¼ ë§í¬ì—¬ì•¼ í•©ë‹ˆë‹¤)');
      return;
    }
    
    try {
      // URL ìœ íš¨ì„± ê²€ì‚¬
      new URL(url);
      
      // ì¤‘ë³µ ì²´í¬
      if (subscribedCalendars.some(cal => cal.url === url)) {
        alert('ì´ë¯¸ êµ¬ë…ëœ ìº˜ë¦°ë”ì…ë‹ˆë‹¤.');
        return;
      }
      
      // ìƒˆ ìº˜ë¦°ë” ì¶”ê°€
      const newCalendar = {
        id: Date.now(),
        url: url,
        name: `êµ¬ë… ìº˜ë¦°ë” ${subscribedCalendars.length + 1}`,
        enabled: true,
        color: getRandomColor()
      };
      
      subscribedCalendars.push(newCalendar);
      document.getElementById('calendarUrl').value = '';
      
      // UI ì—…ë°ì´íŠ¸
      updateSubscribedCalendarsList();
      loadSubscribedCalendarEvents(newCalendar);
      saveSubscribedCalendars();
      
    } catch (error) {
      alert('ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
    }
  }
  
  // ëœë¤ ìƒ‰ìƒ ìƒì„±
  function getRandomColor() {
    const colors = ['#4285f4', '#34a853', '#ea4335', '#fbbc04', '#9c27b0', '#ff6d00', '#607d8b', '#795548', '#e91e63', '#00bcd4'];
    return colors[Math.floor(Math.random() * colors.length)];
  }
  
  // êµ¬ë…ëœ ìº˜ë¦°ë” ëª©ë¡ UI ì—…ë°ì´íŠ¸
  function updateSubscribedCalendarsList() {
    const container = document.getElementById('subscribedCalendarsList');
    container.innerHTML = '';
    
    if (subscribedCalendars.length === 0) {
      container.innerHTML = '<p style="color: #666; font-size: 12px; text-align: center;">êµ¬ë…ëœ ìº˜ë¦°ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    
    subscribedCalendars.forEach(calendar => {
      const calendarItem = document.createElement('div');
      calendarItem.style.cssText = 'display: flex; align-items: center; gap: 8px; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;';
      
      const toggle = document.createElement('input');
      toggle.type = 'checkbox';
      toggle.checked = calendar.enabled;
      toggle.onchange = () => toggleCalendar(calendar.id);
      
      const colorDot = document.createElement('div');
      colorDot.style.cssText = `width: 12px; height: 12px; border-radius: 50%; background-color: ${calendar.color};`;
      
      const name = document.createElement('span');
      name.textContent = calendar.name;
      name.style.cssText = 'flex: 1; font-size: 12px;';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'ì‚­ì œ';
      deleteBtn.className = 'btn btn-secondary';
      deleteBtn.style.cssText = 'padding: 2px 6px; font-size: 10px;';
      deleteBtn.onclick = () => removeCalendar(calendar.id);
      
      calendarItem.appendChild(toggle);
      calendarItem.appendChild(colorDot);
      calendarItem.appendChild(name);
      calendarItem.appendChild(deleteBtn);
      container.appendChild(calendarItem);
    });
  }
  
  // ìº˜ë¦°ë” í† ê¸€ (ì¼œê¸°/ë„ê¸°)
  function toggleCalendar(calendarId) {
    const calendar = subscribedCalendars.find(cal => cal.id === calendarId);
    if (calendar) {
      calendar.enabled = !calendar.enabled;
      updateSubscribedCalendarsList();
      loadAllSubscribedEvents();
      saveSubscribedCalendars();
    }
  }
  
  // ìº˜ë¦°ë” ì œê±°
  function removeCalendar(calendarId) {
    if (confirm('ì •ë§ë¡œ ì´ ìº˜ë¦°ë”ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      subscribedCalendars = subscribedCalendars.filter(cal => cal.id !== calendarId);
      updateSubscribedCalendarsList();
      loadAllSubscribedEvents();
      saveSubscribedCalendars();
    }
  }
  
  // êµ¬ë… ìº˜ë¦°ë” ì´ë²¤íŠ¸ ë¡œë“œ
  async function loadSubscribedCalendarEvents(calendar) {
    try {
      // iCal íŒŒì¼ì—ì„œ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const response = await fetch(calendar.url);
      const icsData = await response.text();
      
      // iCal ë°ì´í„° íŒŒì‹±
      const events = parseICalData(icsData, calendar);
      
      // ê¸°ì¡´ ì´ë²¤íŠ¸ì— ì¶”ê°€
      calendarEvents = calendarEvents.concat(events);
      
      // ìº˜ë¦°ë” ë‹¤ì‹œ ë Œë”ë§
      renderCalendar();
      
    } catch (error) {
      console.error('êµ¬ë… ìº˜ë¦°ë” ì´ë²¤íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
      alert('ìº˜ë¦°ë” ì´ë²¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }
  }
  
  // iCal ë°ì´í„° íŒŒì‹± í•¨ìˆ˜
  function parseICalData(icsData, calendar) {
    const events = [];
    const lines = icsData.split('\n');
    
    let currentEvent = null;
    
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i].trim();
      
      if (line === 'BEGIN:VEVENT') {
        currentEvent = {
          calendarId: calendar.id,
          color: calendar.color
        };
      } else if (line === 'END:VEVENT') {
        if (currentEvent && currentEvent.title && currentEvent.date) {
          events.push(currentEvent);
        }
        currentEvent = null;
      } else if (currentEvent) {
        if (line.startsWith('SUMMARY:')) {
          currentEvent.title = line.substring(8);
        } else if (line.startsWith('DTSTART:')) {
          const dateStr = line.substring(8);
          const date = parseICalDate(dateStr);
          currentEvent.date = date.toISOString().split('T')[0];
          
          // ì‹œê°„ì´ í¬í•¨ëœ ê²½ìš°
          if (dateStr.length > 8) {
            currentEvent.time = date.toLocaleTimeString('ko-KR', { 
              hour: '2-digit', 
              minute: '2-digit', 
              hour12: false 
            });
          } else {
            currentEvent.time = 'ì¢…ì¼';
          }
        } else if (line.startsWith('DESCRIPTION:')) {
          currentEvent.description = line.substring(12);
        }
      }
    }
    
    return events;
  }
  
  // iCal ë‚ ì§œ íŒŒì‹±
  function parseICalDate(dateStr) {
    // iCal í˜•ì‹: 20241201T090000Z ë˜ëŠ” 20241201
    if (dateStr.includes('T')) {
      // ë‚ ì§œì™€ ì‹œê°„ì´ ëª¨ë‘ í¬í•¨ëœ ê²½ìš°
      const year = parseInt(dateStr.substring(0, 4));
      const month = parseInt(dateStr.substring(4, 6)) - 1;
      const day = parseInt(dateStr.substring(6, 8));
      const hour = parseInt(dateStr.substring(9, 11));
      const minute = parseInt(dateStr.substring(11, 13));
      const second = parseInt(dateStr.substring(13, 15));
      
      return new Date(year, month, day, hour, minute, second);
    } else {
      // ë‚ ì§œë§Œ í¬í•¨ëœ ê²½ìš°
      const year = parseInt(dateStr.substring(0, 4));
      const month = parseInt(dateStr.substring(4, 6)) - 1;
      const day = parseInt(dateStr.substring(6, 8));
      
      return new Date(year, month, day);
    }
  }
  
  // êµ¬ë… ìº˜ë¦°ë”ìš© ìƒ˜í”Œ ì´ë²¤íŠ¸ ìƒì„±
  function generateSampleEventsForCalendar(calendar) {
    const events = [];
    const today = new Date();
    
    // ì´ë²ˆ ë‹¬ì˜ ìƒ˜í”Œ ì´ë²¤íŠ¸ë“¤
    for (let i = 0; i < 5; i++) {
      const eventDate = new Date(today.getFullYear(), today.getMonth(), Math.floor(Math.random() * 28) + 1);
      const hour = Math.floor(Math.random() * 10) + 9;
      const minute = Math.random() > 0.5 ? '00' : '30';
      
      const sampleTitles = [
        `${calendar.name} - íšŒì˜`, `${calendar.name} - ë¯¸íŒ…`, `${calendar.name} - í”„ë¡œì íŠ¸`,
        `${calendar.name} - ì›Œí¬ìˆ`, `${calendar.name} - êµìœ¡`
      ];
      
      events.push({
        title: sampleTitles[Math.floor(Math.random() * sampleTitles.length)],
        date: eventDate.toISOString().split('T')[0],
        time: `${hour}:${minute}`,
        calendarId: calendar.id,
        color: calendar.color
      });
    }
    
    return events;
  }
  
  // ëª¨ë“  êµ¬ë… ìº˜ë¦°ë” ì´ë²¤íŠ¸ ë¡œë“œ
  async function loadAllSubscribedEvents() {
    // ê¸°ì¡´ êµ¬ë… ìº˜ë¦°ë” ì´ë²¤íŠ¸ ì œê±°
    calendarEvents = calendarEvents.filter(event => !event.calendarId);
    
    // í™œì„±í™”ëœ êµ¬ë… ìº˜ë¦°ë”ë“¤ì˜ ì´ë²¤íŠ¸ ë¡œë“œ
    for (const calendar of subscribedCalendars.filter(cal => cal.enabled)) {
      try {
        const response = await fetch(calendar.url);
        const icsData = await response.text();
        const events = parseICalData(icsData, calendar);
        calendarEvents = calendarEvents.concat(events);
      } catch (error) {
        console.error(`ìº˜ë¦°ë” ${calendar.name} ë¡œë“œ ì˜¤ë¥˜:`, error);
      }
    }
    
    renderCalendar();
  }
  
  // êµ¬ë…ëœ ìº˜ë¦°ë” ì €ì¥
  function saveSubscribedCalendars() {
    localStorage.setItem('subscribedCalendars', JSON.stringify(subscribedCalendars));
  }
  
  // êµ¬ë…ëœ ìº˜ë¦°ë” ë¶ˆëŸ¬ì˜¤ê¸°
  async function loadSubscribedCalendars() {
    const saved = localStorage.getItem('subscribedCalendars');
    if (saved) {
      subscribedCalendars = JSON.parse(saved);
      updateSubscribedCalendarsList();
      await loadAllSubscribedEvents();
    }
  }
  
  // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
  function saveToStorage() {
    const data = JSON.stringify({
      view: currentView,
      accentColor: accentColor,
      accentHoverColor: accentHoverColor,
      apiKey: document.getElementById('apiKey')?.value || '',
      calendarId: document.getElementById('calendarId')?.value || 'primary'
    });
    window.calendarStorage = data;
  }
  
  function loadFromStorage() {
    if (window.calendarStorage) {
      try {
        const data = JSON.parse(window.calendarStorage);
        currentView = data.view || 'month';
        accentColor = data.accentColor || '#4285f4';
        accentHoverColor = data.accentHoverColor || darkenColor(accentColor, 15);
        
        // UI ë³µì›
        document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(currentView + 'Btn').classList.add('active');
        
        if (document.getElementById('apiKey')) {
          document.getElementById('apiKey').value = data.apiKey || '';
          document.getElementById('calendarId').value = data.calendarId || 'primary';
        }
      } catch (e) {
        console.log('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }
  }
  
  // ì´ˆê¸°í™” ì‹¤í–‰
  init();
  
  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT') return;
    
    switch(e.key) {
      case 'ArrowLeft':
        navigateCalendar(-1);
        break;
      case 'ArrowRight':
        navigateCalendar(1);
        break;
      case 't':
      case 'T':
        goToToday();
        break;
      case 'm':
      case 'M':
        setView('month');
        break;
      case 'w':
      case 'W':
        setView('week');
        break;
      case 'd':
      case 'D':
        setView('day');
        break;
    }
  });
  
  // Enter í‚¤ ì´ë²¤íŠ¸
  document.getElementById('calendarId').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      loadCalendarData();
    }
  });
  
  document.getElementById('apiKey').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      loadCalendarData();
    }
  });
  
  document.getElementById('calendarUrl').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      addSubscribedCalendar();
    }
  });
</script>
</body>
</html>
