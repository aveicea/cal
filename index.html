<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë©€í‹° ìº˜ë¦°ë” ë·°ì–´</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #ffffff;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  .header {
    padding: 10px 20px;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
  }
  
  .view-selector {
    display: flex;
    gap: 8px;
    align-items: center;
    flex: 1;
    justify-content: center;
  }
  
  .view-btn {
    padding: 6px 12px;
    border: 1px solid #ddd;
    background: white;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: #666;
  }
  
  .view-btn.active {
    background: var(--accent-color, #4285f4);
    color: white;
    border-color: var(--accent-color, #4285f4);
  }
  
  .nav-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-right: 20px;
  }
  
  .nav-btn {
    width: 32px;
    height: 32px;
    border: 1px solid #ddd;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .nav-btn:hover {
    background: #f8f9fa;
  }
  
  .current-date {
    padding: 6px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    min-width: 120px;
    text-align: center;
  }
  
  .settings-btn {
    width: 32px;
    height: 32px;
    border: none;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    transition: all 0.2s ease;
  }
  
  .settings-btn:hover {
    background: #e8eaed;
    color: #333;
  }
  
  .settings-panel {
    position: absolute;
    top: 45px;
    right: 20px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    width: 450px;
    z-index: 1000;
    display: none;
    max-height: 70vh;
    overflow-y: auto;
  }
  
  .settings-title {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 15px;
    color: #333;
  }
  
  .color-picker-group {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .color-picker-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 10px;
    color: #333;
  }
  
  .color-input-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .color-picker-input {
    width: 40px;
    height: 30px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    padding: 0;
  }
  
  .color-text-input {
    flex: 1;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 12px;
    font-family: monospace;
  }
  
  .preset-colors {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 4px;
  }
  
  .preset-color {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .preset-color:hover {
    transform: scale(1.1);
    border-color: #333;
  }
  
  .calendar-list-section {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .calendar-item {
    display: flex;
    align-items: center;
    padding: 8px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    margin-bottom: 8px;
    background: #f8f9fa;
  }
  
  .calendar-item.active {
    border-color: var(--accent-color, #4285f4);
    background: #e3f2fd;
  }
  
  .calendar-color-picker {
    width: 24px;
    height: 24px;
    border: none;
    border-radius: 50%;
    margin-right: 8px;
    cursor: pointer;
    padding: 0;
    background: none;
    box-shadow: 0 0 0 2px white, 0 0 0 3px #ddd;
  }

  .calendar-color-picker:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }
  
  .calendar-info {
    flex: 1;
  }
  
  .calendar-name {
    font-size: 13px;
    font-weight: 500;
    color: #333;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    width: 100%;
  }
  
  .calendar-name:focus {
    outline: 1px solid var(--accent-color, #4285f4);
    outline-offset: 1px;
    border-radius: 2px;
  }
  
  .calendar-url {
    font-size: 11px;
    color: #666;
    word-break: break-all;
    margin-top: 2px;
  }

  .calendar-status {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    margin-top: 2px;
    display: inline-block;
  }

  .calendar-status.success {
    background: #e8f5e8;
    color: #2e7d32;
  }

  .calendar-status.error {
    background: #ffebee;
    color: #c62828;
  }

  .calendar-status.loading {
    background: #e3f2fd;
    color: #1976d2;
  }
  
  .calendar-actions {
    display: flex;
    gap: 4px;
  }
  
  .toggle-btn {
    width: 20px;
    height: 20px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.2s ease;
  }
  
  .toggle-btn.visible {
    background: var(--accent-color, #4285f4);
    color: white;
  }
  
  .toggle-btn.hidden {
    background: #ccc;
    color: white;
  }
  
  .remove-btn {
    background: #f44336;
    color: white;
  }

  .reload-btn {
    background: #ff9800;
    color: white;
    font-size: 10px;
  }
  
  .add-calendar-section {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .input-group {
    margin-bottom: 10px;
  }
  
  .input-group label {
    display: block;
    font-size: 12px;
    color: #666;
    margin-bottom: 4px;
  }
  
  .input-group input, .input-group textarea, .input-group select {
    width: 100%;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 12px;
    box-sizing: border-box;
    resize: vertical;
  }
  
  .help-text {
    font-size: 11px;
    color: #888;
    margin-top: 4px;
    line-height: 1.4;
  }
  
  .btn {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-right: 8px;
    margin-bottom: 8px;
  }
  
  .btn-primary {
    background: var(--accent-color, #4285f4);
    color: white;
  }
  
  .btn-primary:hover {
    background: var(--accent-hover-color, #3367d6);
  }
  
  .btn-secondary {
    background: #f8f9fa;
    color: #666;
    border: 1px solid #ddd;
  }
  
  .calendar-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  .calendar-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #f8f9fa;
  }
  
  .calendar-grid {
    display: grid;
    gap: 1px;
    background: #e0e0e0;
    border: 1px solid #e0e0e0;
    width: 100%;
    height: 100%;
    min-height: 500px;
  }
  
  .calendar-day {
    background: white;
    min-height: 80px;
    padding: 6px;
    position: relative;
    font-size: 12px;
  }
  
  .calendar-day.other-month {
    background: #f8f9fa;
    color: #999;
  }
  
  .calendar-day.today {
    background: #e3f2fd;
  }
  
  .day-number {
    font-weight: 500;
    margin-bottom: 3px;
  }
  
  .event {
    padding: 1px 3px;
    border-radius: 2px;
    font-size: 10px;
    margin-bottom: 1px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: white;
    cursor: pointer;
  }
  
  .week-view {
    display: grid;
    grid-template-columns: 60px repeat(7, 1fr);
    gap: 1px;
    background: #e0e0e0;
    height: calc(100vh - 140px);
    min-height: 400px;
  }
  
  .time-slot {
    background: white;
    padding: 2px;
    font-size: 11px;
    color: #666;
    border-right: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .week-day {
    background: white;
    position: relative;
    padding: 0;
  }

  .week-day .event {
    position: absolute;
    left: 0;
    right: 0;
    border-radius: 2px;
    padding: 2px 4px;
    color: white;
    font-weight: 500;
    display: flex;
    align-items: center;
    font-size: 10px;
    word-wrap: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
    z-index: 1;
  }

  .calendar-day .event:hover {
    opacity: 0.8;
    transform: translateY(-1px);
    transition: all 0.2s ease;
  }
  
  .week-header {
    background: #f5f5f5;
    padding: 4px;
    font-weight: 500;
    text-align: center;
    font-size: 12px;
  }
  
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 200px;
    color: #666;
  }
  
  .error-message {
    background: #ffebee;
    border: 1px solid #ffcdd2;
    border-radius: 8px;
    padding: 16px;
    margin: 20px;
    color: #c62828;
    font-size: 12px;
  }
  
  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.1);
    z-index: 999;
    display: none;
  }

  .debug-section {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e0e0;
  }

  .debug-log {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 10px;
    font-family: monospace;
    font-size: 11px;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 10px;
  }
  
  @media (max-width: 768px) {
    .settings-panel {
      right: 10px;
      left: 10px;
      width: auto;
    }
    .nav-controls {
      margin-right: 10px;
    }
    .calendar-grid {
      grid-template-columns: repeat(7, 1fr);
    }
    .calendar-day {
      min-height: 60px;
    }
  }
  
  /* ì›”ê°„ ë·° */
  .month-view {
    grid-template-columns: repeat(7, 1fr);
    grid-template-rows: auto repeat(6, 1fr);
  }
  
  /* ì£¼ê°„ ë·° í—¤ë” */
  .week-view .week-header {
    grid-column: span 1;
  }
  
  .week-view .time-header {
    background: #f5f5f5;
    grid-column: 1;
  }
  
  .url-example {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 8px;
    font-family: monospace;
    font-size: 11px;
    color: #666;
    margin-top: 8px;
    word-break: break-all;
  }

  .day-view {
    display: grid;
    grid-template-columns: 60px 1fr;
    gap: 1px;
    background: #e0e0e0;
    height: calc(100vh - 140px);
    min-height: 400px;
  }

  .day-view .time-slot {
    height: 40px;
  }

  .day-view .week-day {
    height: 40px;
  }

  .hour-slot {
    height: 40px;
    display: flex;
    align-items: flex-start;
    padding-top: 2px;
  }
</style>
</head>
<body>
  <div class="header">
    <div class="view-selector">
      <button class="view-btn active" onclick="setView('day')" id="dayBtn">ì¼</button>
      <button class="view-btn" onclick="setView('week')" id="weekBtn">ì£¼</button>
      <button class="view-btn" onclick="setView('month')" id="monthBtn">ì›”</button>
    </div>
    
    <div class="nav-controls">
      <button class="nav-btn" onclick="navigateCalendar(-1)">â€¹</button>
      <div class="current-date" id="currentDate"></div>
      <button class="nav-btn" onclick="navigateCalendar(1)">â€º</button>
      <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
    </div>
    
    <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
    
    <div class="settings-panel" id="settingsPanel">
      <div class="settings-title">ë©€í‹° ìº˜ë¦°ë” ì„¤ì •</div>
      
      <div class="color-picker-group">
        <div class="color-picker-title">í…Œë§ˆ ìƒ‰ìƒ</div>
        <div class="color-input-row">
          <input type="color" class="color-picker-input" id="colorPicker" onchange="updateColorFromPicker()">
          <input type="text" class="color-text-input" id="colorText" placeholder="#4285F4" oninput="updateColorFromText()" maxlength="7">
        </div>
        <div class="preset-colors">
          <div class="preset-color" style="background-color: #4285f4;" onclick="setPresetColor('#4285f4')"></div>
          <div class="preset-color" style="background-color: #34a853;" onclick="setPresetColor('#34a853')"></div>
          <div class="preset-color" style="background-color: #ea4335;" onclick="setPresetColor('#ea4335')"></div>
          <div class="preset-color" style="background-color: #ffc107;" onclick="setPresetColor('#ffc107')"></div>
          <div class="preset-color" style="background-color: #9c27b0;" onclick="setPresetColor('#9c27b0')"></div>
          <div class="preset-color" style="background-color: #607d8b;" onclick="setPresetColor('#607d8b')"></div>
        </div>
      </div>
      
      <div class="calendar-list-section">
        <div class="color-picker-title">ì—°ë™ëœ ìº˜ë¦°ë” ëª©ë¡</div>
        <button class="btn btn-secondary" onclick="addSampleCalendar()" style="margin-bottom: 10px;">ìƒ˜í”Œ ìº˜ë¦°ë” ì¶”ê°€</button>
        <div id="calendarList">
          <p style="color: #666; font-size: 12px; text-align: center; padding: 20px;">
            ì—°ë™ëœ ìº˜ë¦°ë”ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìƒ˜í”Œ ìº˜ë¦°ë”ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì•„ë˜ì—ì„œ ìº˜ë¦°ë”ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
          </p>
        </div>
      </div>
      
      <div class="add-calendar-section">
        <div class="color-picker-title">ìº˜ë¦°ë” ì¶”ê°€</div>
        <div class="input-group">
          <label>ìº˜ë¦°ë” ìœ í˜•</label>
          <select id="calendarType" onchange="updateCalendarInputs()">
            <option value="ical">iCal ë§í¬ (.ics)</option>
            <option value="googlePublic">êµ¬ê¸€ ìº˜ë¦°ë” ê³µê°œ ë§í¬</option>
            <option value="api">êµ¬ê¸€ ìº˜ë¦°ë” API</option>
          </select>
        </div>
        
        <div class="input-group">
          <label>ìº˜ë¦°ë” ì´ë¦„</label>
          <input type="text" id="calendarName" placeholder="ì˜ˆ: ê°œì¸ ì¼ì •, ì—…ë¬´ ìº˜ë¦°ë”">
        </div>
        
        <div class="input-group">
          <label>ìº˜ë¦°ë” ìƒ‰ìƒ</label>
          <input type="color" id="calendarColor" value="#4285f4">
        </div>
        
        <div id="icalInputs" class="calendar-inputs">
          <div class="input-group">
            <label>iCal ë§í¬</label>
            <textarea id="icalUrl" rows="3" placeholder="https://calendar.google.com/calendar/ical/.../basic.ics"></textarea>
            <div class="help-text">
              êµ¬ê¸€ ìº˜ë¦°ë” ì„¤ì • â†’ í†µí•© ë° ê³µìœ  â†’ ë¹„ê³µê°œ ì£¼ì†Œì˜ iCal ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”.
            </div>
          </div>
        </div>
        
        <div id="googlePublicInputs" class="calendar-inputs" style="display: none;">
          <div class="input-group">
            <label>êµ¬ê¸€ ìº˜ë¦°ë” ID</label>
            <input type="text" id="googleCalendarId" placeholder="ìº˜ë¦°ë”ID@group.calendar.google.com">
            <div class="help-text">
              ê³µê°œëœ êµ¬ê¸€ ìº˜ë¦°ë”ì˜ ìº˜ë¦°ë” IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br>
              ì˜ˆ: ko.south_korea#holiday@group.v.calendar.google.com (í•œêµ­ ê³µíœ´ì¼)
            </div>
          </div>
        </div>
        
        <div id="apiInputs" class="calendar-inputs" style="display: none;">
          <div class="input-group">
            <label>API í‚¤</label>
            <input type="text" id="apiKey" placeholder="Google Calendar API í‚¤">
          </div>
          <div class="input-group">
            <label>ìº˜ë¦°ë” ID</label>
            <input type="text" id="calendarId" placeholder="primary ë˜ëŠ” ì´ë©”ì¼@gmail.com">
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="addCalendar()">ìº˜ë¦°ë” ì¶”ê°€</button>
      </div>

      <div class="debug-section">
        <div class="color-picker-title">ë””ë²„ê·¸ ì •ë³´</div>
        <button class="btn btn-secondary" onclick="clearDebugLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="debugLog" class="debug-log"></div>
      </div>
    </div>
  </div>
  
  <div class="overlay" id="overlay" onclick="closeSettings()"></div>
  
  <div class="calendar-container">
    <div class="calendar-content" id="calendarContent">
      <div class="calendar-grid day-view" id="emptyCalendar">
        <div class="week-header time-header">ì‹œê°„</div>
        <div class="week-header">ì¼ê°„ ë·°</div>
      </div>
    </div>
  </div>

<script>
  // ì „ì—­ ë³€ìˆ˜
  let currentView = 'day';
  let currentDate = new Date();
  let accentColor = '#4285f4';
  let accentHoverColor = '#3367d6';
  let calendars = [];
  let debugMessages = [];
  
  // ìº˜ë¦°ë” ìƒ‰ìƒ íŒ”ë ˆíŠ¸
  const calendarColors = [
    '#4285f4', '#34a853', '#ea4335', '#ffc107', '#9c27b0', '#607d8b'
  ];
  
  // DOM ìš”ì†Œ
  const settingsPanel = document.getElementById("settingsPanel");
  const overlay = document.getElementById("overlay");
  const colorPicker = document.getElementById("colorPicker");
  const colorText = document.getElementById("colorText");
  const currentDateElement = document.getElementById("currentDate");
  const calendarContent = document.getElementById("calendarContent");
  const calendarList = document.getElementById("calendarList");
  const debugLog = document.getElementById("debugLog");
  
  // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
  function addDebugLog(message) {
    const timestamp = new Date().toLocaleTimeString();
    debugMessages.push(`[${timestamp}] ${message}`);
    if (debugMessages.length > 50) debugMessages.shift();
    
    if (debugLog) {
      debugLog.innerHTML = debugMessages.map(msg => `<div>${msg}</div>`).join('');
      debugLog.scrollTop = debugLog.scrollHeight;
    }
    console.log(message);
  }

  function clearDebugLog() {
    debugMessages = [];
    if (debugLog) {
      debugLog.innerHTML = '';
    }
  }
  
  // ì´ˆê¸°í™”
  function init() {
    loadFromStorage();
    updateCurrentDateDisplay();
    setAccentColor(accentColor);
    updateCalendarList();
    renderCalendar();
    addDebugLog('ìº˜ë¦°ë” ë·°ì–´ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
  
  // ì„¤ì • íŒ¨ë„
  function toggleSettings() {
    const isVisible = settingsPanel.style.display === 'block';
    if (isVisible) {
      closeSettings();
    } else {
      openSettings();
    }
  }
  
  function openSettings() {
    settingsPanel.style.display = 'block';
    overlay.style.display = 'block';
  }
  
  function closeSettings() {
    settingsPanel.style.display = 'none';
    overlay.style.display = 'none';
  }
  
  // ë·° ë³€ê²½
  function setView(viewMode) {
    currentView = viewMode;
    document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(viewMode + 'Btn').classList.add('active');
    updateCurrentDateDisplay();
    renderCalendar();
    saveToStorage();
  }
  
  // ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜
  function navigateCalendar(direction) {
    if (currentView === 'month') {
      currentDate.setMonth(currentDate.getMonth() + direction);
    } else if (currentView === 'week') {
      currentDate.setDate(currentDate.getDate() + (direction * 7));
    } else if (currentView === 'day') {
      currentDate.setDate(currentDate.getDate() + direction);
    }
    updateCurrentDateDisplay();
    renderCalendar();
  }
  
  function goToToday() {
    currentDate = new Date();
    updateCurrentDateDisplay();
    renderCalendar();
  }
  
  function updateCurrentDateDisplay() {
    if (currentView === 'day') {
      const options = { month: 'long', day: 'numeric', weekday: 'short' };
      const formatted = currentDate.toLocaleDateString('ko-KR', options);
      currentDateElement.textContent = formatted.replace(/(\d+ì¼)\s*(\([^)]+\))/, '$1 $2');
    } else if (currentView === 'week') {
      const options = { year: 'numeric', month: 'long' };
      currentDateElement.textContent = currentDate.toLocaleDateString('ko-KR', options);
    } else {
      const options = { year: 'numeric', month: 'long' };
      currentDateElement.textContent = currentDate.toLocaleDateString('ko-KR', options);
    }
  }
  
  // ìƒ‰ìƒ ê´€ë¦¬
  function darkenColor(hex, percent) {
    const num = parseInt(hex.replace("#", ""), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) - amt;
    const G = (num >> 8 & 0x00FF) - amt;
    const B = (num & 0x0000FF) - amt;
    return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
      (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
      (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
  }
  
  function setAccentColor(color) {
    accentColor = color;
    accentHoverColor = darkenColor(color, 15);
    
    document.documentElement.style.setProperty('--accent-color', color);
    document.documentElement.style.setProperty('--accent-hover-color', accentHoverColor);
    
    if (colorPicker) colorPicker.value = color;
    if (colorText) colorText.value = color.toUpperCase();
    
    saveToStorage();
  }
  
  function setPresetColor(color) {
    setAccentColor(color);
  }
  
  function updateColorFromPicker() {
    setAccentColor(colorPicker.value);
  }
  
  function updateColorFromText() {
    let color = colorText.value.trim();
    if (!color.startsWith('#')) color = '#' + color;
    if (/^#[0-9A-F]{6}$/i.test(color)) {
      setAccentColor(color);
    }
  }
  
  // ìº˜ë¦°ë” ì…ë ¥ í¼ ì—…ë°ì´íŠ¸
  function updateCalendarInputs() {
    const type = document.getElementById('calendarType').value;
    
    document.querySelectorAll('.calendar-inputs').forEach(input => {
      input.style.display = 'none';
    });
    
    document.getElementById(type + 'Inputs').style.display = 'block';
  }
  
  // ìƒ˜í”Œ ìº˜ë¦°ë” ì¶”ê°€
  function addSampleCalendar() {
    const sampleEvents = generateSampleEvents();
    const sampleCalendar = {
      id: 'sample-' + Date.now(),
      name: 'ìƒ˜í”Œ ìº˜ë¦°ë”',
      type: 'sample',
      color: calendarColors[calendars.length % calendarColors.length],
      visible: true,
      events: sampleEvents,
      status: 'success',
      statusMessage: `${sampleEvents.length}ê°œ ì´ë²¤íŠ¸`
    };
    
    calendars.push(sampleCalendar);
    updateCalendarList();
    renderCalendar();
    saveToStorage();
    addDebugLog('ìƒ˜í”Œ ìº˜ë¦°ë”ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
  
  // ìƒ˜í”Œ ì´ë²¤íŠ¸ ìƒì„±
  function generateSampleEvents() {
    const events = [];
    const today = new Date();
    
    // ì˜¤ëŠ˜ë¶€í„° 30ì¼ê°„ì˜ ìƒ˜í”Œ ì´ë²¤íŠ¸ ìƒì„±
    for (let i = -5; i < 25; i++) {
      const eventDate = new Date(today);
      eventDate.setDate(today.getDate() + i);
      
      // ëœë¤í•˜ê²Œ ì´ë²¤íŠ¸ ì¶”ê°€
      if (Math.random() > 0.7) {
        events.push({
          title: getSampleEventTitle(),
          date: eventDate.toISOString().split('T')[0],
          time: Math.random() > 0.3 ? getSampleEventTime() : 'ì¢…ì¼',
          startTime: Math.random() > 0.3 ? getSampleEventTime() : 'ì¢…ì¼',
          endTime: Math.random() > 0.3 ? getSampleEventTime() : 'ì¢…ì¼',
          description: 'ìƒ˜í”Œ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.'
        });
      }
    }
    
    return events;
  }
  
  function getSampleEventTitle() {
    const titles = [
      'íŒ€ íšŒì˜', 'í”„ë¡œì íŠ¸ ë¯¸íŒ…', 'ì ì‹¬ ì•½ì†', 'ì˜ì‚¬ ì§„ë£Œ', 'ìš´ë™',
      'ì¹œêµ¬ ë§Œë‚˜ê¸°', 'ì‡¼í•‘', 'ì˜í™” ë³´ê¸°', 'ë…ì„œ', 'ì‚°ì±…',
      'ë°œí‘œ ì¤€ë¹„', 'ë³´ê³ ì„œ ì‘ì„±', 'ê³ ê° ë¯¸íŒ…', 'ì„¸ë¯¸ë‚˜ ì°¸ì„', 'êµìœ¡ ìˆ˜ê°•'
    ];
    return titles[Math.floor(Math.random() * titles.length)];
  }
  
  function getSampleEventTime() {
    const hour = Math.floor(Math.random() * 12) + 9; // 9ì‹œ-20ì‹œ
    const minute = Math.random() > 0.5 ? '00' : '30';
    return `${hour.toString().padStart(2, '0')}:${minute}`;
  }
  
  // ìº˜ë¦°ë” ìƒ‰ìƒ ì—…ë°ì´íŠ¸
  function updateCalendarColor(calendarId, newColor) {
    const calendar = calendars.find(c => c.id === calendarId);
    if (calendar) {
      calendar.color = newColor;
      renderCalendar();
      saveToStorage();
      addDebugLog(`ìº˜ë¦°ë” ìƒ‰ìƒ ë³€ê²½: ${calendar.name} â†’ ${newColor}`);
    }
  }

  // ìº˜ë¦°ë” ì´ë¦„ ì—…ë°ì´íŠ¸
  function updateCalendarName(calendarId, newName) {
    const calendar = calendars.find(c => c.id === calendarId);
    if (calendar && newName.trim()) {
      calendar.name = newName.trim();
      saveToStorage();
      addDebugLog(`ìº˜ë¦°ë” ì´ë¦„ ë³€ê²½: ${newName}`);
    }
  }
  
  function updateCalendarStatus(calendarId, status, message = '') {
    const calendar = calendars.find(c => c.id === calendarId);
    if (calendar) {
      calendar.status = status;
      calendar.statusMessage = message;
      updateCalendarList();
    }
  }
  
  // ìº˜ë¦°ë” ì¶”ê°€
  async function addCalendar() {
    const type = document.getElementById('calendarType').value;
    const name = document.getElementById('calendarName').value.trim();
    const color = document.getElementById('calendarColor').value;
    
    if (!name) {
      alert('ìº˜ë¦°ë” ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    let url = '';
    let calendarId = '';
    let apiKey = '';
    
    if (type === 'ical') {
      url = document.getElementById('icalUrl').value.trim();
      if (!url || !url.includes('.ics')) {
        alert('ì˜¬ë°”ë¥¸ iCal ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
    } else if (type === 'googlePublic') {
      calendarId = document.getElementById('googleCalendarId').value.trim();
      if (!calendarId) {
        alert('êµ¬ê¸€ ìº˜ë¦°ë” IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
    } else if (type === 'api') {
      apiKey = document.getElementById('apiKey').value.trim();
      calendarId = document.getElementById('calendarId').value.trim() || 'primary';
      if (!apiKey) {
        alert('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
    }
    
    const calendar = {
      id: Date.now().toString(),
      name: name,
      type: type,
      color: color,
      visible: true,
      url: url,
      calendarId: calendarId,
      apiKey: apiKey,
      events: [],
      status: 'loading',
      statusMessage: 'ë¡œë”© ì¤‘...'
    };
    
    addDebugLog(`ìº˜ë¦°ë” ì¶”ê°€ ì‹œì‘: ${name} (${type})`);
    
    calendars.push(calendar);
    updateCalendarList();
    
    // ìº˜ë¦°ë” ë°ì´í„° ë¡œë“œ
    try {
      await loadCalendarEvents(calendar);
      updateCalendarStatus(calendar.id, 'success', `${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      addDebugLog(`ìº˜ë¦°ë” ë¡œë“œ ì„±ê³µ: ${name}, ${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      renderCalendar();
      saveToStorage();
      
      // ì…ë ¥ í¼ ì´ˆê¸°í™”
      document.getElementById('calendarName').value = '';
      document.getElementById('icalUrl').value = '';
      document.getElementById('googleCalendarId').value = '';
      document.getElementById('apiKey').value = '';
      document.getElementById('calendarId').value = '';
      
      closeSettings();
    } catch (error) {
      updateCalendarStatus(calendar.id, 'error', error.message);
      addDebugLog(`ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨: ${name} - ${error.message}`);
      alert('ìº˜ë¦°ë”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }
  }
  
  // ìº˜ë¦°ë” ì´ë²¤íŠ¸ ë¡œë“œ
  async function loadCalendarEvents(calendar) {
    addDebugLog(`ì´ë²¤íŠ¸ ë¡œë“œ ì‹œì‘: ${calendar.name} (${calendar.type})`);
    
    if (calendar.type === 'ical') {
      await loadIcalEvents(calendar);
    } else if (calendar.type === 'googlePublic') {
      await loadGooglePublicEvents(calendar);
    } else if (calendar.type === 'api') {
      await loadApiEvents(calendar);
    }
  }
  
  // iCal ì´ë²¤íŠ¸ ë¡œë“œ
  async function loadIcalEvents(calendar) {
    const proxies = [
      `https://cors-anywhere.herokuapp.com/${calendar.url}`,
      `https://api.allorigins.win/get?url=${encodeURIComponent(calendar.url)}`,
      `https://corsproxy.io/?${encodeURIComponent(calendar.url)}`,
      `https://cors.sh/${calendar.url}`,
      `https://proxy.cors.sh/${calendar.url}`
    ];
    
    let lastError = null;
    
    for (const proxyUrl of proxies) {
      try {
        addDebugLog(`í”„ë¡ì‹œ ì‹œë„: ${proxyUrl.split('/')[2]}`);
        
        const response = await fetch(proxyUrl, {
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        let icalData;
        if (proxyUrl.includes('allorigins')) {
          const data = await response.json();
          icalData = data.contents;
        } else {
          icalData = await response.text();
        }
        
        if (!icalData || !icalData.includes('BEGIN:VCALENDAR')) {
          throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ iCal ë°ì´í„°');
        }
        
        calendar.events = parseIcalData(icalData);
        addDebugLog(`iCal íŒŒì‹± ì™„ë£Œ: ${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
        return;
        
      } catch (error) {
        lastError = error;
        addDebugLog(`í”„ë¡ì‹œ ì‹¤íŒ¨: ${proxyUrl.split('/')[2]} - ${error.message}`);
        continue;
      }
    }
    
    throw new Error(`ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨. ë§ˆì§€ë§‰ ì˜¤ë¥˜: ${lastError.message}`);
  }
  
  // êµ¬ê¸€ ê³µê°œ ìº˜ë¦°ë” ë¡œë“œ
  async function loadGooglePublicEvents(calendar) {
    const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString();
    const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0).toISOString();
    
    // ê³µê°œ API í‚¤ (ì œí•œì ì´ì§€ë§Œ ê³µê°œ ìº˜ë¦°ë”ìš©)
    const apiKey = 'AIzaSyBNlYH01_9Hc5S1J9vuFmu2nUqBZJNAXxs'; // ë°ëª¨ìš© í‚¤
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendar.calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;
    
    try {
      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error(`API ì˜¤ë¥˜: ${response.status} - ${response.statusText}`);
      }
      
      const data = await response.json();
      
      if (!data.items) {
        throw new Error('ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
      }
      
      calendar.events = data.items.map(event => {
        const startDate = event.start.dateTime || event.start.date;
        const endDate = event.end.dateTime || event.end.date;
        const startTime = new Date(startDate);
        const endTime = new Date(endDate);
        
        return {
          title: event.summary || 'ì œëª© ì—†ìŒ',
          date: startTime.toISOString().split('T')[0],
          startTime: event.start.dateTime ? 
            startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          endTime: event.end.dateTime ? 
            endTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          time: event.start.dateTime ? 
            startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          color: calendar.color,
          description: event.description || ''
        };
      });
      
      addDebugLog(`êµ¬ê¸€ ê³µê°œ ìº˜ë¦°ë” ë¡œë“œ ì™„ë£Œ: ${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      
    } catch (error) {
      addDebugLog(`êµ¬ê¸€ ê³µê°œ ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
      throw error;
    }
  }
  
  // API ì´ë²¤íŠ¸ ë¡œë“œ
  async function loadApiEvents(calendar) {
    const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString();
    const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0).toISOString();
    
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendar.calendarId)}/events?key=${calendar.apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;
    
    try {
      const response = await fetch(url);
      
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(`API ì˜¤ë¥˜ ${response.status}: ${errorData.error?.message || response.statusText}`);
      }
      
      const data = await response.json();
      
      calendar.events = data.items.map(event => {
        const startDate = event.start.dateTime || event.start.date;
        const endDate = event.end.dateTime || event.end.date;
        const startTime = new Date(startDate);
        const endTime = new Date(endDate);
        
        return {
          title: event.summary || 'ì œëª© ì—†ìŒ',
          date: startTime.toISOString().split('T')[0],
          startTime: event.start.dateTime ? 
            startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          endTime: event.end.dateTime ? 
            endTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          time: event.start.dateTime ? 
            startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
            'ì¢…ì¼',
          color: calendar.color,
          description: event.description || ''
        };
      });
      
      addDebugLog(`API ìº˜ë¦°ë” ë¡œë“œ ì™„ë£Œ: ${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      
    } catch (error) {
      addDebugLog(`API ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
      throw error;
    }
  }
  
  // iCal ë°ì´í„° íŒŒì‹± í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
  function parseIcalData(icalText) {
    const events = [];
    const lines = icalText.split(/\r?\n/);
    let currentEvent = null;
    
    addDebugLog(`iCal íŒŒì‹± ì‹œì‘: ${lines.length}ì¤„`);
    
    for (let i = 0; i < lines.length; i++) {
      let line = lines[i].trim();
      
      // ë©€í‹°ë¼ì¸ ì²˜ë¦¬
      while (i + 1 < lines.length && lines[i + 1].match(/^\s/)) {
        i++;
        line += lines[i].trim();
      }
      
      if (line === 'BEGIN:VEVENT') {
        currentEvent = {};
      } else if (line === 'END:VEVENT' && currentEvent) {
        if (currentEvent.summary && currentEvent.dtstart) {
          events.push({
            title: currentEvent.summary,
            date: currentEvent.date,
            time: currentEvent.time || 'ì¢…ì¼',
            startTime: currentEvent.startTime || currentEvent.time || 'ì¢…ì¼',
            endTime: currentEvent.endTime || currentEvent.time || 'ì¢…ì¼',
            description: currentEvent.description || ''
          });
        }
        currentEvent = null;
      } else if (currentEvent) {
        const colonIndex = line.indexOf(':');
        if (colonIndex > 0) {
          const key = line.substring(0, colonIndex).split(';')[0];
          const value = line.substring(colonIndex + 1);
          
          switch (key) {
            case 'SUMMARY':
              currentEvent.summary = decodeIcalText(value);
              break;
            case 'DESCRIPTION':
              currentEvent.description = decodeIcalText(value);
              break;
            case 'DTSTART':
              const startDate = parseIcalDate(value);
              if (startDate) {
                currentEvent.dtstart = startDate.date;
                currentEvent.date = startDate.date;
                currentEvent.time = startDate.time;
                currentEvent.startTime = startDate.time;
              }
              break;
            case 'DTEND':
              const endDate = parseIcalDate(value);
              if (endDate) {
                currentEvent.endTime = endDate.time;
              }
              break;
          }
        }
      }
    }
    
    addDebugLog(`iCal íŒŒì‹± ì™„ë£Œ: ${events.length}ê°œ ì´ë²¤íŠ¸ ì¶”ì¶œ`);
    return events;
  }
  
  // iCal í…ìŠ¤íŠ¸ ë””ì½”ë”©
  function decodeIcalText(text) {
    return text
      .replace(/\\n/g, ' ')
      .replace(/\\,/g, ',')
      .replace(/\\;/g, ';')
      .replace(/\\\\/g, '\\')
      .trim();
  }
  
  // iCal ë‚ ì§œ íŒŒì‹± í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
  function parseIcalDate(dateString) {
    try {
      // YYYYMMDD í˜•ì‹ (ì¢…ì¼ ì´ë²¤íŠ¸)
      if (dateString.length === 8) {
        const year = parseInt(dateString.substring(0, 4));
        const month = parseInt(dateString.substring(4, 6));
        const day = parseInt(dateString.substring(6, 8));
        const date = new Date(year, month - 1, day);
        return {
          date: date.toISOString().split('T')[0],
          time: 'ì¢…ì¼'
        };
      }
      
      // YYYYMMDDTHHMMSS[Z] í˜•ì‹ (ì‹œê°„ í¬í•¨)
      if (dateString.length >= 15) {
        const year = parseInt(dateString.substring(0, 4));
        const month = parseInt(dateString.substring(4, 6));
        const day = parseInt(dateString.substring(6, 8));
        const hour = parseInt(dateString.substring(9, 11));
        const minute = parseInt(dateString.substring(11, 13));
        
        const date = new Date(year, month - 1, day, hour, minute);
        
        // UTC ì‹œê°„ì¸ ê²½ìš° (Zë¡œ ëë‚¨) ë¡œì»¬ ì‹œê°„ìœ¼ë¡œ ë³€í™˜
        if (dateString.endsWith('Z')) {
          const localDate = new Date(date.getTime() - (date.getTimezoneOffset() * 60000));
          return {
            date: localDate.toISOString().split('T')[0],
            time: localDate.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false })
          };
        }
        
        return {
          date: date.toISOString().split('T')[0],
          time: `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`
        };
      }
    } catch (e) {
      addDebugLog(`ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜: ${dateString} - ${e.message}`);
    }
    return null;
  }
  
  // ìº˜ë¦°ë” ëª©ë¡ ì—…ë°ì´íŠ¸
  function updateCalendarList() {
    if (calendars.length === 0) {
      calendarList.innerHTML = `
        <p style="color: #666; font-size: 12px; text-align: center; padding: 20px;">
          ì—°ë™ëœ ìº˜ë¦°ë”ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìƒ˜í”Œ ìº˜ë¦°ë”ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì•„ë˜ì—ì„œ ìº˜ë¦°ë”ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!
        </p>
      `;
      return;
    }
    
    calendarList.innerHTML = calendars.map(calendar => `
      <div class="calendar-item ${calendar.visible ? 'active' : ''}" data-id="${calendar.id}">
        <input type="color" value="${calendar.color}" 
               onchange="updateCalendarColor('${calendar.id}', this.value)" 
               class="calendar-color-picker" 
               title="ìº˜ë¦°ë” ìƒ‰ìƒ ë³€ê²½">
        <div class="calendar-info">
          <input class="calendar-name" value="${calendar.name}" 
                 onchange="updateCalendarName('${calendar.id}', this.value)"
                 onblur="updateCalendarName('${calendar.id}', this.value)">
          <div class="calendar-url">${calendar.type === 'sample' ? 'ìƒ˜í”Œ ë°ì´í„°' : 
            (calendar.url || calendar.calendarId || '').substring(0, 30)}${(calendar.url || calendar.calendarId || '').length > 30 ? '...' : ''}</div>
          <div class="calendar-status ${calendar.status}">${calendar.statusMessage || calendar.status}</div>
        </div>
        <div class="calendar-actions">
          <button class="toggle-btn ${calendar.visible ? 'visible' : 'hidden'}" 
                  onclick="toggleCalendarVisibility('${calendar.id}')" 
                  title="${calendar.visible ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ì´ê¸°'}">
            ${calendar.visible ? 'ğŸ‘ï¸' : 'ğŸš«'}
          </button>
          <button class="toggle-btn reload-btn" onclick="reloadCalendar('${calendar.id}')" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
          <button class="toggle-btn remove-btn" onclick="removeCalendar('${calendar.id}')" title="ì‚­ì œ">âŒ</button>
        </div>
      </div>
    `).join('');
  }
  
  // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
  async function reloadCalendar(calendarId) {
    const calendar = calendars.find(c => c.id === calendarId);
    if (!calendar) return;
    
    if (calendar.type === 'sample') {
      // ìƒ˜í”Œ ìº˜ë¦°ë”ëŠ” ìƒˆ ë°ì´í„° ìƒì„±
      calendar.events = generateSampleEvents();
      updateCalendarStatus(calendarId, 'success', `${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      renderCalendar();
      saveToStorage();
      addDebugLog(`ìƒ˜í”Œ ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ: ${calendar.name}`);
      return;
    }
    
    updateCalendarStatus(calendarId, 'loading', 'ìƒˆë¡œê³ ì¹¨ ì¤‘...');
    addDebugLog(`ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨: ${calendar.name}`);
    
    try {
      calendar.events = [];
      await loadCalendarEvents(calendar);
      updateCalendarStatus(calendarId, 'success', `${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
      renderCalendar();
      saveToStorage();
      addDebugLog(`ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ: ${calendar.name}`);
    } catch (error) {
      updateCalendarStatus(calendarId, 'error', error.message);
      addDebugLog(`ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ${calendar.name} - ${error.message}`);
    }
  }
  
  // ìº˜ë¦°ë” ê°€ì‹œì„± í† ê¸€
  function toggleCalendarVisibility(calendarId) {
    const calendar = calendars.find(c => c.id === calendarId);
    if (calendar) {
      calendar.visible = !calendar.visible;
      updateCalendarList();
      renderCalendar();
      saveToStorage();
      addDebugLog(`ìº˜ë¦°ë” ê°€ì‹œì„± ë³€ê²½: ${calendar.name} - ${calendar.visible ? 'ë³´ì„' : 'ìˆ¨ê¹€'}`);
    }
  }
  
  // ìº˜ë¦°ë” ì‚­ì œ
  function removeCalendar(calendarId) {
    const calendar = calendars.find(c => c.id === calendarId);
    if (calendar && confirm(`'${calendar.name}' ìº˜ë¦°ë”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      calendars = calendars.filter(c => c.id !== calendarId);
      updateCalendarList();
      renderCalendar();
      saveToStorage();
      addDebugLog(`ìº˜ë¦°ë” ì‚­ì œë¨: ${calendar.name}`);
    }
  }
  
  // ìº˜ë¦°ë” ë Œë”ë§
  function renderCalendar() {
    if (currentView === 'month') {
      renderMonthView();
    } else if (currentView === 'week') {
      renderWeekView();
    } else if (currentView === 'day') {
      renderDayView();
    }
  }
  
  function renderMonthView() {
    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
    const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const grid = document.createElement('div');
    grid.className = 'calendar-grid month-view';
    
    // ìš”ì¼ í—¤ë”
    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    weekdays.forEach(day => {
      const header = document.createElement('div');
      header.className = 'week-header';
      header.textContent = day;
      grid.appendChild(header);
    });
    
    // ë‚ ì§œ ì…€
    const today = new Date();
    for (let i = 0; i < 42; i++) {
      const cellDate = new Date(startDate);
      cellDate.setDate(startDate.getDate() + i);
      
      const cell = document.createElement('div');
      cell.className = 'calendar-day';
      
      if (cellDate.getMonth() !== currentDate.getMonth()) {
        cell.classList.add('other-month');
      }
      
      if (cellDate.toDateString() === today.toDateString()) {
        cell.classList.add('today');
      }
      
      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = cellDate.getDate();
      cell.appendChild(dayNumber);
      
      // ëª¨ë“  ìº˜ë¦°ë”ì˜ ì´ë²¤íŠ¸ í‘œì‹œ
      const dayEvents = getAllEventsForDate(cellDate);
      dayEvents.slice(0, 4).forEach(event => { // ìµœëŒ€ 4ê°œë§Œ í‘œì‹œ
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event';
        eventDiv.style.backgroundColor = event.color;
        eventDiv.textContent = event.title;
        eventDiv.title = `${event.title}\nì‹œê°„: ${event.time}\nìº˜ë¦°ë”: ${event.calendarName}${event.description ? '\nì„¤ëª…: ' + event.description : ''}`;
        cell.appendChild(eventDiv);
      });
      
      // ë” ë§ì€ ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
      if (dayEvents.length > 4) {
        const moreDiv = document.createElement('div');
        moreDiv.className = 'event';
        moreDiv.style.backgroundColor = '#999';
        moreDiv.textContent = `+${dayEvents.length - 4}ê°œ ë”`;
        cell.appendChild(moreDiv);
      }
      
      grid.appendChild(cell);
    }
    
    calendarContent.innerHTML = '';
    calendarContent.appendChild(grid);
  }

  // ì£¼ê°„ ë·° ë Œë”ë§
  function renderWeekView() {
    const startOfWeek = new Date(currentDate);
    startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
    
    const container = document.createElement('div');
    container.style.padding = '20px';
    container.style.height = '100%';
    container.style.overflow = 'auto';
    
    const grid = document.createElement('div');
    grid.className = 'time-based-view week-view';
    
    const today = new Date();
    
    // ì‹œê°„ í—¤ë”
    const timeHeader = document.createElement('div');
    timeHeader.className = 'week-header time-header';
    timeHeader.textContent = 'ì‹œê°„';
    grid.appendChild(timeHeader);
    
    // ìš”ì¼ í—¤ë”
    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    for (let i = 0; i < 7; i++) {
      const date = new Date(startOfWeek);
      date.setDate(startOfWeek.getDate() + i);
      
      const header = document.createElement('div');
      header.className = 'week-header';
      if (date.toDateString() === today.toDateString()) {
        header.classList.add('today');
      }
      
      const dayName = document.createElement('div');
      dayName.textContent = weekdays[i];
      header.appendChild(dayName);
      
      const dayNumber = document.createElement('small');
      dayNumber.textContent = date.getDate();
      header.appendChild(dayNumber);
      
      grid.appendChild(header);
    }
    
    // ì‹œê°„ ìŠ¬ë¡¯ (6ì‹œ-23ì‹œ)
    for (let hour = 6; hour <= 23; hour++) {
      // ì‹œê°„ ë¼ë²¨
      const timeSlot = document.createElement('div');
      timeSlot.className = 'time-slot';
      timeSlot.textContent = `${hour}:00`;
      grid.appendChild(timeSlot);

      // ê° ìš”ì¼ë³„ ì¹¸
      for (let day = 0; day < 7; day++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + day);
        
        const cell = document.createElement('div');
        cell.className = 'week-day';

        // ì´ ë‚ ì§œì™€ ì‹œê°„ì˜ ì´ë²¤íŠ¸ë“¤ ì°¾ê¸°////////////
        const dayEvents = getAllEventsForDate(date);
        const hourEvents = getEventsForHour(dayEvents, hour);
        
        hourEvents.forEach((event, index) => {
          const eventDiv = document.createElement('div');
          
          if (event.time === 'ì¢…ì¼') {
            eventDiv.className = 'all-day-event';
          } else {
            eventDiv.className = 'time-event';
            const { top, height } = calculateEventPosition(event, hour);
            eventDiv.style.top = `${top}px`;
            eventDiv.style.height = `${Math.max(height, 20)}px`;
          }
          
          eventDiv.style.backgroundColor = event.color;
          eventDiv.textContent = event.title;
          eventDiv.title = `${event.title}\nì‹œê°„: ${event.startTime} - ${event.endTime}\nìº˜ë¦°ë”: ${event.calendarName}`;
          
          // ê²¹ì¹˜ëŠ” ì´ë²¤íŠ¸ë“¤ ì•½ê°„ ì˜¤í”„ì…‹
          if (index > 0) {
            eventDiv.style.left = `${4 + index * 2}px`;
            eventDiv.style.right = `${4 + index * 2}px`;
            eventDiv.style.zIndex = index + 1;
          }
          
          cell.appendChild(eventDiv);
        });
        
        grid.appendChild(cell);
      }
    }
    
    container.appendChild(grid);
    calendarContent.innerHTML = '';
    calendarContent.appendChild(container);

  // ì¼ê°„ ë·° ë Œë”ë§
  function renderDayView() {
    const container = document.createElement('div');
    container.style.padding = '20px';
    container.style.height = '100%';
    container.style.overflow = 'auto';
    
    const grid = document.createElement('div');
    grid.className = 'time-based-view day-view';
    
    const today = new Date();
    
    // í—¤ë”
    const timeHeader = document.createElement('div');
    timeHeader.className = 'week-header';
    timeHeader.textContent = 'ì‹œê°„';
    grid.appendChild(timeHeader);
    
    const dayHeader = document.createElement('div');
    dayHeader.className = 'week-header';
    if (currentDate.toDateString() === today.toDateString()) {
      dayHeader.classList.add('today');
    }
    
    const dayName = document.createElement('div');
    const options = { month: 'short', day: 'numeric', weekday: 'short' };
    dayName.textContent = currentDate.toLocaleDateString('ko-KR', options);
    dayHeader.appendChild(dayName);
    
    grid.appendChild(dayHeader);
    
    // ì‹œê°„ ìŠ¬ë¡¯ (6ì‹œ-23ì‹œ)
    for (let hour = 6; hour <= 23; hour++) {
      // ì‹œê°„ ë¼ë²¨
      const timeSlot = document.createElement('div');
      timeSlot.className = 'time-slot';
      timeSlot.textContent = `${hour}:00`;
      grid.appendChild(timeSlot);
      
      // ì¼ì • ì¹¸
      const cell = document.createElement('div');
      cell.className = 'day-column';
      
      // ì´ ì‹œê°„ëŒ€ì˜ ëª¨ë“  ì´ë²¤íŠ¸ ì°¾ê¸°
      const dayEvents = getAllEventsForDate(currentDate);
      const hourEvents = getEventsForHour(dayEvents, hour);
      
      hourEvents.forEach((event, index) => {
        const eventDiv = document.createElement('div');
        
        if (event.time === 'ì¢…ì¼') {
          eventDiv.className = 'all-day-event';
        } else {
          eventDiv.className = 'time-event';
          const { top, height } = calculateEventPosition(event, hour);
          eventDiv.style.top = `${top}px`;
          eventDiv.style.height = `${Math.max(height, 20)}px`;
        }
        
        eventDiv.style.backgroundColor = event.color;
        eventDiv.textContent = event.title;
        eventDiv.title = `${event.title}\nì‹œê°„: ${event.startTime} - ${event.endTime}\nìº˜ë¦°ë”: ${event.calendarName}`;
        
        // ê²¹ì¹˜ëŠ” ì´ë²¤íŠ¸ë“¤ ì•½ê°„ ì˜¤í”„ì…‹
        if (index > 0) {
          eventDiv.style.left = `${4 + index * 2}px`;
          eventDiv.style.right = `${4 + index * 2}px`;
          eventDiv.style.zIndex = index + 1;
        }
        
        cell.appendChild(eventDiv);
      });
      
      grid.appendChild(cell);
    }
    
    container.appendChild(grid);
    calendarContent.innerHTML = '';
    calendarContent.appendChild(container);
  }
  
  // íŠ¹ì • ì‹œê°„ëŒ€ì˜ ì´ë²¤íŠ¸ë“¤ ê°€ì ¸ì˜¤ê¸°
  function getEventsForHour(dayEvents, hour) {
    const hourEvents = [];
    
    dayEvents.forEach(event => {
      if (event.time === 'ì¢…ì¼') {
        // ì¢…ì¼ ì´ë²¤íŠ¸ëŠ” ì²« ë²ˆì§¸ ì‹œê°„ëŒ€(1ì‹œ)ì—ë§Œ í‘œì‹œ
        if (hour === 1) {
          hourEvents.push(event);
        }
      } else {
        const startHour = getEventHour(event.startTime);
        const endHour = getEventHour(event.endTime);
        
        // ì´ë²¤íŠ¸ê°€ í˜„ì¬ ì‹œê°„ëŒ€ì— ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
        if (startHour <= hour && hour < Math.max(endHour, startHour + 1)) {
          // ì‹œì‘ ì‹œê°„ëŒ€ì—ì„œë§Œ ì´ë²¤íŠ¸ ìƒì„± (ì¤‘ë³µ ë°©ì§€)
          if (hour === startHour) {
            hourEvents.push(event);
          }
        }
      }
    });
    
    return hourEvents;
  }
  
  // ì´ë²¤íŠ¸ ìœ„ì¹˜ì™€ ë†’ì´ ê³„ì‚°
  function calculateEventPosition(event, currentHour) {
    const SLOT_HEIGHT = 50; // CSSì—ì„œ ì •ì˜í•œ ì‹œê°„ ìŠ¬ë¡¯ ë†’ì´ì™€ ë§ì¶¤
    
    if (event.time === 'ì¢…ì¼') {
      return {
        top: 2,
        height: 24
      };
    }
    
    const startHour = getEventHour(event.startTime);
    const startMinute = getEventMinute(event.startTime);
    const endHour = getEventHour(event.endTime);
    const endMinute = getEventMinute(event.endTime);
    
    // ì‹œì‘ ìœ„ì¹˜ ê³„ì‚° (ë¶„ ë‹¨ìœ„ë¡œ)
    const top = (startMinute / 60) * SLOT_HEIGHT;
    
    // ì´ë²¤íŠ¸ ì „ì²´ ê¸¸ì´ ê³„ì‚° (ì‹œê°„ ë‹¨ìœ„)
    const durationHours = endHour - startHour;
    const durationMinutes = endMinute - startMinute;
    const totalDuration = durationHours + (durationMinutes / 60);
    
    // ë†’ì´ ê³„ì‚° (ìµœì†Œ 20px)
    const height = Math.max(totalDuration * SLOT_HEIGHT - 2, 20);
    
    return { top, height };
  }

  // ì´ë²¤íŠ¸ ì‹œê°„ íŒŒì‹± í—¬í¼ í•¨ìˆ˜ë“¤
  function getEventHour(timeString) {
    if (timeString === 'ì¢…ì¼') return 6;
    const parts = timeString.split(':');
    return parseInt(parts[0]);
  }

  function getEventMinute(timeString) {
    if (timeString === 'ì¢…ì¼') return 0;
    const parts = timeString.split(':');
    return parseInt(parts[1] || 0);
  }
  
  // ëª¨ë“  ìº˜ë¦°ë”ì˜ íŠ¹ì • ë‚ ì§œ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
  function getAllEventsForDate(date) {
    const allEvents = [];
    
    calendars.forEach(calendar => {
      if (!calendar.visible || !calendar.events) return;
      
      const events = calendar.events.filter(event => {
        const eventDate = new Date(event.date + 'T00:00:00');
        return eventDate.toDateString() === date.toDateString();
      });
      
      events.forEach(event => {
        allEvents.push({
          ...event,
          color: calendar.color,
          calendarName: calendar.name
        });
      });
    });
    
    // ì‹œê°„ìˆœ ì •ë ¬
    allEvents.sort((a, b) => {
      if (a.time === 'ì¢…ì¼' && b.time !== 'ì¢…ì¼') return -1;
      if (a.time !== 'ì¢…ì¼' && b.time === 'ì¢…ì¼') return 1;
      if (a.time === 'ì¢…ì¼' && b.time === 'ì¢…ì¼') return 0;
      return a.time.localeCompare(b.time);
    });
    
    return allEvents;
  }
  
  // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
  function saveToStorage() {
    try {
      const data = {
        view: currentView,
        currentDate: currentDate.toISOString(),
        accentColor: accentColor,
        accentHoverColor: accentHoverColor,
        calendars: calendars.map(cal => ({
          ...cal,
          // ì´ë²¤íŠ¸ë„ í•¨ê»˜ ì €ì¥í•˜ì—¬ ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì§€
          events: cal.events || []
        }))
      };
      
      // localStorageì— ì €ì¥
      localStorage.setItem('multiCalendarData', JSON.stringify(data));
      addDebugLog('ì„¤ì •ì´ localStorageì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (e) {
      addDebugLog(`ì €ì¥ ì‹¤íŒ¨: ${e.message}`);
    }
  }
  
  function loadFromStorage() {
    try {
      const data = localStorage.getItem('multiCalendarData');
      if (data) {
        const parsed = JSON.parse(data);
        currentView = parsed.view || 'day';
        if (parsed.currentDate) {
          currentDate = new Date(parsed.currentDate);
        }
        accentColor = parsed.accentColor || '#4285f4';
        accentHoverColor = parsed.accentHoverColor || darkenColor(accentColor, 15);
        calendars = parsed.calendars || [];
        
        // UI ë³µì›
        document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(currentView + 'Btn').classList.add('active');
        
        // ì €ì¥ëœ ìº˜ë¦°ë”ë“¤ì˜ ì´ë²¤íŠ¸ ë‹¤ì‹œ ë¡œë“œ (API ê¸°ë°˜ ìº˜ë¦°ë”ë§Œ)
        calendars.forEach(async (calendar) => {
          if (calendar.type !== 'sample' && (!calendar.events || calendar.events.length === 0)) {
            updateCalendarStatus(calendar.id, 'loading', 'ë¡œë”© ì¤‘...');
            try {
              await loadCalendarEvents(calendar);
              updateCalendarStatus(calendar.id, 'success', `${calendar.events.length}ê°œ ì´ë²¤íŠ¸`);
            } catch (error) {
              updateCalendarStatus(calendar.id, 'error', error.message);
              addDebugLog(`ì €ì¥ëœ ìº˜ë¦°ë” ë¡œë“œ ì‹¤íŒ¨: ${calendar.name} - ${error.message}`);
            }
          } else {
            // ì´ë¯¸ ì €ì¥ëœ ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ ì„±ê³µ ìƒíƒœë¡œ í‘œì‹œ
            updateCalendarStatus(calendar.id, 'success', `${(calendar.events || []).length}ê°œ ì´ë²¤íŠ¸`);
          }
        });
        
        addDebugLog('ì„¤ì •ì´ localStorageì—ì„œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    } catch (e) {
      addDebugLog(`ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${e.message}`);
    }
  }
  
  // ì´ˆê¸°í™” ì‹¤í–‰
  init();
  
  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    switch(e.key) {
      case 'ArrowLeft':
        navigateCalendar(-1);
        e.preventDefault();
        break;
      case 'ArrowRight':
        navigateCalendar(1);
        e.preventDefault();
        break;
      case 't':
      case 'T':
        goToToday();
        break;
      case 'm':
      case 'M':
        setView('month');
        break;
      case 'w':
      case 'W':
        setView('week');
        break;
      case 'd':
      case 'D':
        setView('day');
        break;
      case 'Escape':
        closeSettings();
        break;
    }
  });
  
  // ìº˜ë¦°ë” ìƒ‰ìƒ ìë™ í• ë‹¹
  document.getElementById('calendarColor').addEventListener('focus', function() {
    this.value = calendarColors[calendars.length % calendarColors.length];
  });
  
  // í•œêµ­ ê³µíœ´ì¼ ìƒ˜í”Œ ì¶”ê°€
  function addKoreanHolidays() {
    const holidayCalendar = {
      id: 'korean-holidays-' + Date.now(),
      name: 'í•œêµ­ ê³µíœ´ì¼',
      type: 'googlePublic',
      color: '#ea4335',
      visible: true,
      calendarId: 'ko.south_korea#holiday@group.v.calendar.google.com',
      events: [],
      status: 'loading',
      statusMessage: 'ë¡œë”© ì¤‘...'
    };
    
    calendars.push(holidayCalendar);
    updateCalendarList();
    
    loadCalendarEvents(holidayCalendar)
      .then(() => {
        updateCalendarStatus(holidayCalendar.id, 'success', `${holidayCalendar.events.length}ê°œ ì´ë²¤íŠ¸`);
        renderCalendar();
        saveToStorage();
        addDebugLog('í•œêµ­ ê³µíœ´ì¼ ìº˜ë¦°ë” ì¶”ê°€ ì™„ë£Œ');
      })
      .catch(error => {
        updateCalendarStatus(holidayCalendar.id, 'error', error.message);
        addDebugLog(`í•œêµ­ ê³µíœ´ì¼ ìº˜ë¦°ë” ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`);
      });
  }
  
  // ë””ë²„ê·¸ìš© í•¨ìˆ˜ë“¤
  window.debugCalendar = {
    showCalendars: () => console.table(calendars),
    showEvents: (calendarId) => {
      const calendar = calendars.find(c => c.id === calendarId || c.name === calendarId);
      if (calendar) {
        console.table(calendar.events);
      } else {
        console.log('ìº˜ë¦°ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    },
    clearStorage: () => {
      localStorage.removeItem('multiCalendarData');
      location.reload();
    },
    addKoreanHolidays: addKoreanHolidays,
    addSampleCalendar: addSampleCalendar
  };
  
  // ë„ì›€ë§ í‘œì‹œ
  console.log('%cë©€í‹° ìº˜ë¦°ë” ë·°ì–´ ë””ë²„ê·¸ ë„êµ¬%c\n' +
    'debugCalendar.showCalendars() - ëª¨ë“  ìº˜ë¦°ë” ì •ë³´ í‘œì‹œ\n' +
    'debugCalendar.showEvents(ìº˜ë¦°ë”ID) - íŠ¹ì • ìº˜ë¦°ë”ì˜ ì´ë²¤íŠ¸ í‘œì‹œ\n' +
    'debugCalendar.clearStorage() - ì €ì¥ëœ ë°ì´í„° ì‚­ì œ ë° ìƒˆë¡œê³ ì¹¨\n' +
    'debugCalendar.addKoreanHolidays() - í•œêµ­ ê³µíœ´ì¼ ìº˜ë¦°ë” ì¶”ê°€\n' +
    'debugCalendar.addSampleCalendar() - ìƒ˜í”Œ ìº˜ë¦°ë” ì¶”ê°€', 
    'color: #4285f4; font-weight: bold; font-size: 14px;', 
    'color: #333; font-size: 12px;');
</script>
</body>
</html>
